System.register(["jimu-core","jimu-arcgis"],(function(e,t){var o={},n={};return{setters:[function(e){o.React=e.React},function(e){n.JimuMapViewComponent=e.JimuMapViewComponent}],execute:function(){e((()=>{var e={686:e=>{"use strict";e.exports=n},244:e=>{"use strict";e.exports=o}},t={};function i(o){var n=t[o];if(void 0!==n)return n.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,i),a.exports}i.d=(e,t)=>{for(var o in t)i.o(t,o)&&!i.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.p="";var a={};return i.p=window.jimuConfig.baseUrl,(()=>{"use strict";i.r(a),i.d(a,{__set_webpack_public_path__:()=>l,default:()=>r});var e=i(244),t=i(686),o=function(e,t,o,n){return new(o||(o=Promise))((function(i,a){function r(e){try{s(n.next(e))}catch(e){a(e)}}function l(e){try{s(n.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(r,l)}s((n=n.apply(e,t||[])).next())}))};const n=(e,t="distance")=>{const o={distance:["imperial","metric","inches","nautical miles","nautical-miles","feet (us)","feet-us","us feet","us-feet"],area:["imperial","metric","square inches","square-inches","square nautical miles","square-nautical-miles","square feet (us)","square-feet-us","square us feet","square-us-feet","ares"]}[t],n=()=>{try{const t=e.container;if(t){t.querySelectorAll("button, calcite-button").forEach((e=>{var t;const o=(e.textContent||"").toLowerCase().trim();(o.includes("new measurement")||"new measurement"===o)&&(e.style.display="none !important",e.style.visibility="hidden",e.hidden=!0,null===(t=e.remove)||void 0===t||t.call(e))}));t.querySelectorAll(".esri-distance-measurement-2d__hint, .esri-area-measurement-2d__hint, .esri-measurement__hint").forEach((e=>{var t;e.style.display="none",null===(t=e.remove)||void 0===t||t.call(e)}))}}catch(e){}};n(),setTimeout(n,10),setTimeout(n,50),setTimeout(n,100);let i=0;const a=()=>{if(i++>15)return;try{const t=e.container;if(t){["calcite-select calcite-option","select option",'[role="option"]',"calcite-option"].forEach((e=>{t.querySelectorAll(e).forEach((e=>{const t=(e.value||"").toLowerCase().trim(),n=(e.textContent||e.innerText||"").toLowerCase().trim(),i=(e.label||"").toLowerCase().trim();if(o.some((e=>{const o=e.toLowerCase();return t===o||n===o||i===o||t.includes(o)||n.includes(o)||i.includes(o)}))){e.style.display="none",e.style.visibility="hidden",e.hidden=!0,e.disabled=!0;try{e.remove()}catch(e){}}}))}));t.querySelectorAll("button, calcite-button").forEach((e=>{const t=(e.textContent||"").toLowerCase().trim();if(t.includes("new measurement")||"new measurement"===t){e.style.display="none",e.style.visibility="hidden",e.hidden=!0;try{e.remove()}catch(e){}}}));t.querySelectorAll(".esri-distance-measurement-2d__hint, .esri-area-measurement-2d__hint, .esri-measurement__hint").forEach((e=>{e.style.display="none";try{e.remove()}catch(e){}}))}}catch(e){console.warn("Error during cleanup:",e)}const t=[50,100,150,200,300,500,750,1e3,1500,2e3,3e3,4e3,5e3,7e3,1e4];i<=t.length&&setTimeout(a,t[i-1]||1e3)};a()},r=i=>{var a,r,l,s,c,d,u,m,p,f,g,y,v,x,h,b,w,k,M,C,R,$,S,E,T,O,P,A,j,F,L,D,z,W,I,q,G,_,N,U,H,B,Y;const X=(null===(a=i.config)||void 0===a?void 0:a.useMapWidgetIds)||i.useMapWidgetIds,[Z,J]=e.React.useState({contextMenu:{visible:!1,x:0,y:0},showingContextMenu:!1,isMeasuring:!1,measurementWidget:null,isMeasuringArea:!1,areaMeasurementWidget:null,layerFieldMetadata:{},coordinateMarkers:[],nextMarkerNumber:1,plotModeActive:!1,simpleMarkers:[],textGraphics:[],showTextDialog:!1,pendingTextLocation:null}),V=e.React.useRef(null);e.React.useEffect((()=>{const e=document.querySelector(".widget-right-click-map"),t=t=>{t.target instanceof Node&&(null==e?void 0:e.contains(t.target))&&(t.preventDefault(),t.stopImmediatePropagation())};return document.addEventListener("contextmenu",t,{capture:!0,passive:!1}),()=>{document.removeEventListener("contextmenu",t,{capture:!0})}}),[]),e.React.useEffect((()=>{o(void 0,void 0,void 0,(function*(){var e,t;if(!(null===(t=null===(e=i.config)||void 0===e?void 0:e.featureLayers)||void 0===t?void 0:t.length))return;const o={};for(const e of i.config.featureLayers)if(e.url)try{const t=yield fetch(`${e.url}?f=json`),n=yield t.json();n.fields&&(o[e.url]={},n.fields.forEach((t=>{o[e.url][t.name]={alias:t.alias||t.name,type:t.type}})))}catch(t){console.warn(`Failed to load field metadata for layer: ${e.url}`,t)}J((e=>Object.assign(Object.assign({},e),{layerFieldMetadata:o})))}))}),[null===(r=i.config)||void 0===r?void 0:r.featureLayers]);const K=e.React.useCallback((()=>{J((e=>Object.assign(Object.assign({},e),{showingContextMenu:!1,contextMenu:Object.assign(Object.assign({},e.contextMenu),{visible:!1})})))}),[]),Q=e.React.useCallback((e=>{try{const t=document.createElement("textarea");t.value=e,t.style.cssText="position:fixed;left:-999999px;top:-999999px;",document.body.appendChild(t),t.select();const o=document.execCommand("copy");document.body.removeChild(t),o||prompt("Please copy these coordinates manually:",e)}catch(t){prompt("Please copy these coordinates manually:",e)}}),[]),ee=e.React.useCallback((e=>o(void 0,void 0,void 0,(function*(){return new Promise((t=>{window.require(["esri/geometry/projection","esri/geometry/SpatialReference","esri/geometry/Point"],((o,n,i)=>{o.load().then((()=>{try{const a=new n({wkid:4326}),r=new i({x:e.x,y:e.y,spatialReference:e.spatialReference}),l=o.project(r,a);void 0!==(null==l?void 0:l.x)&&void 0!==(null==l?void 0:l.y)&&Math.abs(l.y)<=90&&Math.abs(l.x)<=180?t(l):t(e)}catch(o){t(e)}})).catch((()=>t(e)))}))}))}))),[]),te=e.React.useCallback(((e,t)=>o(void 0,void 0,void 0,(function*(){return new Promise((n=>{window.require(["esri/geometry/projection","esri/geometry/SpatialReference","esri/geometry/Point"],((i,a,r)=>o(void 0,void 0,void 0,(function*(){try{yield i.load();const o=new a({wkid:t}),l=new r({x:e.x,y:e.y,spatialReference:e.spatialReference}),s=i.project(l,o);n(s||e)}catch(t){n(e)}}))))}))}))),[]),oe=e.React.useCallback((e=>{var t,o,n,i;try{let a,r;if(4326===(null===(t=e.spatialReference)||void 0===t?void 0:t.wkid)||4269===(null===(o=e.spatialReference)||void 0===o?void 0:o.wkid)||4267===(null===(n=e.spatialReference)||void 0===n?void 0:n.wkid))a=e.x,r=e.y;else{const t=null===(i=e.spatialReference)||void 0===i?void 0:i.wkid;if(t&&t>=26901&&t<=26923){a=6*(t-26900-1)-180+3+(e.x-5e5)/111320,r=e.y/110540}else e.x>1e5&&e.x<3e6?(a=(e.x-5e5)/111320-105,r=39+(e.y-1e6)/110540):(a=e.x/111320,r=e.y/110540);r=Math.max(-85,Math.min(85,r)),a=Math.max(-180,Math.min(180,a))}return{lat:r,lon:a}}catch(t){return{lat:e.y,lon:e.x}}}),[]),ne=e.React.useCallback((()=>o(void 0,void 0,void 0,(function*(){var e,t;const{mapPoint:o}=Z.contextMenu;if(V.current&&o)try{const n=(null===(e=i.config)||void 0===e?void 0:e.coordinateSystem)||"map";let a;if("map"===n)a=`${o.x.toFixed(6)}, ${o.y.toFixed(6)}`;else if("webMercator"===n)try{const e=yield ee(o);if(void 0!==(null==e?void 0:e.x)&&void 0!==(null==e?void 0:e.y)&&Math.abs(e.y)<=90&&Math.abs(e.x)<=180)a=`${e.y.toFixed(6)}, ${e.x.toFixed(6)}`;else{const e=oe(o);a=`${e.lat.toFixed(6)}, ${e.lon.toFixed(6)}`}}catch(e){const t=oe(o);a=`${t.lat.toFixed(6)}, ${t.lon.toFixed(6)}`}else a=`${o.x.toFixed(6)}, ${o.y.toFixed(6)}`;(null===(t=navigator.clipboard)||void 0===t?void 0:t.writeText)?yield navigator.clipboard.writeText(a):Q(a)}catch(e){alert(`Error copying coordinates: ${e.message}`)}}))),[Z.contextMenu,null===(l=i.config)||void 0===l?void 0:l.coordinateSystem,ee,oe,Q]),ie=e.React.useCallback(((e,t)=>{const o=e<0,n=Math.abs(e),i=Math.floor(n),a=60*(n-i),r=Math.floor(a);let l="";return l="lat"===t?o?"S":"N":o?"W":"E",`${i}\xb0 ${r}' ${(60*(a-r)).toFixed(2)}" ${l}`}),[]),ae=e.React.useCallback((()=>{const{mapPoint:e}=Z.contextMenu;e&&J((t=>Object.assign(Object.assign({},t),{showTextDialog:!0,pendingTextLocation:e})))}),[Z.contextMenu]),re=e.React.useCallback((e=>{var t;const o=V.current,n=Z.pendingTextLocation;if(o&&n&&e.trim())try{const a=(null===(t=i.config)||void 0===t?void 0:t.textSettings)||{fontSize:14,fontColor:"#000000",fontFamily:"Arial",fontWeight:"bold",haloColor:"#ffffff",haloSize:2,backgroundColor:"transparent",backgroundOpacity:.8};window.require(["esri/Graphic","esri/symbols/TextSymbol","esri/geometry/Point"],((t,i,r)=>{try{const l=new i({text:e.trim(),color:a.fontColor,haloColor:a.haloColor,haloSize:a.haloSize,font:{size:a.fontSize,weight:a.fontWeight,family:a.fontFamily},verticalAlignment:"middle",horizontalAlignment:"center"});a.backgroundColor&&"transparent"!==a.backgroundColor&&(l.backgroundColor=a.backgroundColor,l.borderLineColor=a.haloColor,l.borderLineSize=1);const s=new t({geometry:new r({x:n.x,y:n.y,spatialReference:n.spatialReference}),symbol:l,attributes:{type:"text-graphic",text:e.trim()}});o.graphics.add(s);const c={id:`text-graphic-${Date.now()}`,point:n.clone(),graphic:s,text:e.trim()};J((e=>Object.assign(Object.assign({},e),{textGraphics:[...e.textGraphics,c],showTextDialog:!1,pendingTextLocation:null})))}catch(e){console.error("Error creating text graphic:",e),alert("Error creating text graphic: "+e.message),J((e=>Object.assign(Object.assign({},e),{showTextDialog:!1,pendingTextLocation:null})))}}))}catch(e){console.error("Error adding text to map:",e),alert(`Error adding text to map: ${e.message}`),J((e=>Object.assign(Object.assign({},e),{showTextDialog:!1,pendingTextLocation:null})))}else J((e=>Object.assign(Object.assign({},e),{showTextDialog:!1,pendingTextLocation:null})))}),[Z.pendingTextLocation,null===(s=i.config)||void 0===s?void 0:s.textSettings]),le=e.React.useCallback((()=>{J((e=>Object.assign(Object.assign({},e),{showTextDialog:!1,pendingTextLocation:null})))}),[]),se=e.React.useCallback((()=>{const e=V.current;if(!e)return;const t=e.graphics.filter((e=>{var t;return"text-graphic"===(null===(t=e.attributes)||void 0===t?void 0:t.type)}));e.graphics.removeMany(t.toArray()),J((e=>Object.assign(Object.assign({},e),{textGraphics:[]})))}),[]),ce=e.React.useCallback((()=>o(void 0,void 0,void 0,(function*(){var e,t,o;const{mapPoint:n}=Z.contextMenu,a=V.current;if(a&&n)try{const r=(null===(e=i.config)||void 0===e?void 0:e.plotSettings)||{markerSize:12,markerColor:"#ff6b6b",markerStyle:"circle",markerOutlineColor:"#ffffff",markerOutlineWidth:1,markerOpacity:1,markerAngle:0,markerXOffset:0,markerYOffset:0,textColor:"#ffffff",textSize:10,showCoordinateText:!0,showCoordinateLabels:!0,coordinateSystem:"map",customWkid:void 0,coordinateFormat:"decimal",decimalPlaces:6,labelOffset:20,labelTextSize:10,labelTextColor:"#000000"};let l,s,c=n;if("webMercator"===r.coordinateSystem)try{if(c=yield ee(n),void 0!==(null==c?void 0:c.x)&&void 0!==(null==c?void 0:c.y)&&Math.abs(c.y)<=90&&Math.abs(c.x)<=180)if("dms"===r.coordinateFormat)l=`${ie(c.y,"lat")}\n${ie(c.x,"lon")}`,s=`${ie(c.y,"lat")}\n${ie(c.x,"lon")}`;else{const e=c.y>=0?"N":"S",t=c.x>=0?"E":"W";l=`Lat: ${Math.abs(c.y).toFixed(r.decimalPlaces||6)}\xb0 ${e}\nLon: ${Math.abs(c.x).toFixed(r.decimalPlaces||6)}\xb0 ${t}`,s=`${Math.abs(c.y).toFixed(r.decimalPlaces||6)}\xb0 ${e}\n${Math.abs(c.x).toFixed(r.decimalPlaces||6)}\xb0 ${t}`}else{const e=oe(n);if("dms"===r.coordinateFormat)l=`${ie(e.lat,"lat")}\n${ie(e.lon,"lon")}`,s=`${ie(e.lat,"lat")}\n${ie(e.lon,"lon")}`;else{const t=e.lat>=0?"N":"S",o=e.lon>=0?"E":"W";l=`Lat: ${Math.abs(e.lat).toFixed(r.decimalPlaces||6)}\xb0 ${t}\nLon: ${Math.abs(e.lon).toFixed(r.decimalPlaces||6)}\xb0 ${o}`,s=`${Math.abs(e.lat).toFixed(r.decimalPlaces||6)}\xb0 ${t}\n${Math.abs(e.lon).toFixed(r.decimalPlaces||6)}\xb0 ${o}`}}}catch(e){const t=oe(n);if("dms"===r.coordinateFormat)l=`${ie(t.lat,"lat")}\n${ie(t.lon,"lon")}`,s=`${ie(t.lat,"lat")}\n${ie(t.lon,"lon")}`;else{const e=t.lat>=0?"N":"S",o=t.lon>=0?"E":"W";l=`Lat: ${Math.abs(t.lat).toFixed(r.decimalPlaces||6)}\xb0 ${e}\nLon: ${Math.abs(t.lon).toFixed(r.decimalPlaces||6)}\xb0 ${o}`,s=`${Math.abs(t.lat).toFixed(r.decimalPlaces||6)}\xb0 ${e}\n${Math.abs(t.lon).toFixed(r.decimalPlaces||6)}\xb0 ${o}`}}else if("custom"===r.coordinateSystem&&r.customWkid)try{c=yield te(n,r.customWkid),l=`X: ${c.x.toFixed(r.decimalPlaces||2)}\nY: ${c.y.toFixed(r.decimalPlaces||2)}\nWKID: ${r.customWkid}`,s=`${c.x.toFixed(r.decimalPlaces||2)}, ${c.y.toFixed(r.decimalPlaces||2)}`}catch(e){l=`X: ${n.x.toFixed(r.decimalPlaces||2)}\nY: ${n.y.toFixed(r.decimalPlaces||2)}\nSR: ${(null===(t=n.spatialReference)||void 0===t?void 0:t.wkid)||"Unknown"}`,s=`${n.x.toFixed(r.decimalPlaces||2)}, ${n.y.toFixed(r.decimalPlaces||2)}`}else l=`X: ${n.x.toFixed(r.decimalPlaces||2)}\nY: ${n.y.toFixed(r.decimalPlaces||2)}\nWKID: ${(null===(o=n.spatialReference)||void 0===o?void 0:o.wkid)||"Unknown"}`,s=`${n.x.toFixed(r.decimalPlaces||2)}, ${n.y.toFixed(r.decimalPlaces||2)}`;window.require(["esri/Graphic","esri/symbols/SimpleMarkerSymbol","esri/symbols/TextSymbol","esri/geometry/Point"],((e,t,o,i)=>{var c;try{const d=Z.nextMarkerNumber,u=new t({color:r.markerColor,outline:{color:r.markerOutlineColor||"#ffffff",width:r.markerOutlineWidth||1},size:r.markerSize,style:r.markerStyle||"circle",angle:r.markerAngle||0,xoffset:r.markerXOffset||0,yoffset:r.markerYOffset||0});void 0!==r.markerOpacity&&1!==r.markerOpacity&&(u.color=[...u.color.toRgb(),r.markerOpacity]);const m=new o({text:d.toString(),color:r.textColor,font:{size:r.textSize,weight:"bold",family:"Arial"},verticalAlignment:"middle",horizontalAlignment:"center",xoffset:r.markerXOffset||0,yoffset:r.markerYOffset||0}),p=new i({x:n.x,y:n.y,spatialReference:n.spatialReference});let f='<div style="font-family: monospace; font-size: 12px; line-height: 1.6; padding: 8px;">';f+=`<div style="font-weight: bold; margin-bottom: 8px;">Marker ${d}</div>`,r.showCoordinateText&&(f+=`<div style="background-color: #f5f5f5; padding: 6px; border-radius: 3px; white-space: pre-line;">${l}</div>`),f+="</div>";const g=new e({geometry:p,symbol:u,attributes:{type:"coordinate-marker",number:d,coordinates:l,originalX:n.x,originalY:n.y,wkid:null===(c=n.spatialReference)||void 0===c?void 0:c.wkid},popupTemplate:{title:`\u{1f4cd} Coordinate Marker ${d}`,content:f}}),y=new e({geometry:p,symbol:m,attributes:{type:"coordinate-text",parentMarker:d}});if(a.graphics.addMany([g,y]),!1!==r.showCoordinateLabels){const t=r.labelOffset||20,l=a.scale,c=t*(l/96/39.37),u=new i({x:n.x+c,y:n.y-c,spatialReference:n.spatialReference}),m=new e({geometry:u,symbol:new o({text:s,color:r.labelTextColor||"#000000",haloColor:"#ffffff",haloSize:2,font:{size:r.labelTextSize||10,weight:"normal",family:"Arial"},verticalAlignment:"top",horizontalAlignment:"left"}),attributes:{type:"coordinate-label",parentMarker:d}});a.graphics.add(m)}const v={id:`marker-${d}`,number:d,point:n.clone(),graphic:g,coordinateText:l};J((e=>Object.assign(Object.assign({},e),{coordinateMarkers:[...e.coordinateMarkers,v],nextMarkerNumber:e.nextMarkerNumber+1})))}catch(e){console.error("Error creating coordinate marker:",e),alert("Error creating coordinate marker: "+e.message)}}))}catch(e){console.error("Error plotting coordinate:",e),alert(`Error plotting coordinate: ${e.message}`)}}))),[Z.contextMenu,Z.nextMarkerNumber,null===(c=i.config)||void 0===c?void 0:c.plotSettings,ee,oe,te,ie]),de=e.React.useCallback((()=>o(void 0,void 0,void 0,(function*(){var e;const{mapPoint:t}=Z.contextMenu,o=V.current;if(o&&t)try{const n=(null===(e=i.config)||void 0===e?void 0:e.markerSettings)||{markerSize:8,markerColor:"#0078ff",markerStyle:"circle",markerOutlineColor:"#ffffff",markerOutlineWidth:1,markerOpacity:1,markerAngle:0,markerXOffset:0,markerYOffset:0};window.require(["esri/Graphic","esri/symbols/SimpleMarkerSymbol","esri/geometry/Point"],((e,i,a)=>{try{const r=new i({color:n.markerColor,outline:{color:n.markerOutlineColor||"#ffffff",width:n.markerOutlineWidth||1},size:n.markerSize,style:n.markerStyle||"circle",angle:n.markerAngle||0,xoffset:n.markerXOffset||0,yoffset:n.markerYOffset||0});void 0!==n.markerOpacity&&1!==n.markerOpacity&&(r.color=[...r.color.toRgb(),n.markerOpacity]);const l=new e({geometry:new a({x:t.x,y:t.y,spatialReference:t.spatialReference}),symbol:r,attributes:{type:"simple-marker"}});o.graphics.add(l);const s={id:`simple-marker-${Date.now()}`,point:t.clone(),graphic:l};J((e=>Object.assign(Object.assign({},e),{simpleMarkers:[...e.simpleMarkers,s]})))}catch(e){console.error("Error creating simple marker:",e),alert("Error creating simple marker: "+e.message)}}))}catch(e){console.error("Error plotting simple marker:",e),alert(`Error plotting simple marker: ${e.message}`)}}))),[Z.contextMenu,null===(d=i.config)||void 0===d?void 0:d.markerSettings]),ue=e.React.useCallback((()=>{const e=V.current;if(!e)return;const t=e.graphics.filter((e=>{var t,o,n;return"coordinate-marker"===(null===(t=e.attributes)||void 0===t?void 0:t.type)||"coordinate-text"===(null===(o=e.attributes)||void 0===o?void 0:o.type)||"coordinate-label"===(null===(n=e.attributes)||void 0===n?void 0:n.type)}));e.graphics.removeMany(t.toArray()),J((e=>Object.assign(Object.assign({},e),{coordinateMarkers:[],nextMarkerNumber:1})))}),[]),me=e.React.useCallback((()=>{const e=V.current;if(!e)return;const t=e.graphics.filter((e=>{var t;return"simple-marker"===(null===(t=e.attributes)||void 0===t?void 0:t.type)}));e.graphics.removeMany(t.toArray()),J((e=>Object.assign(Object.assign({},e),{simpleMarkers:[]})))}),[]),pe=e.React.useCallback((()=>{const e=V.current;if(!e)return;const t=e.graphics.filter((e=>{var t,o,n,i,a;return"coordinate-marker"===(null===(t=e.attributes)||void 0===t?void 0:t.type)||"coordinate-text"===(null===(o=e.attributes)||void 0===o?void 0:o.type)||"coordinate-label"===(null===(n=e.attributes)||void 0===n?void 0:n.type)||"simple-marker"===(null===(i=e.attributes)||void 0===i?void 0:i.type)||"text-graphic"===(null===(a=e.attributes)||void 0===a?void 0:a.type)}));e.graphics.removeMany(t.toArray()),J((e=>Object.assign(Object.assign({},e),{coordinateMarkers:[],nextMarkerNumber:1,simpleMarkers:[],textGraphics:[]})))}),[]),fe=e.React.useCallback((()=>o(void 0,void 0,void 0,(function*(){const{mapPoint:e}=Z.contextMenu;if(V.current&&e)try{let t,o;try{const n=yield ee(e);if(void 0!==(null==n?void 0:n.x)&&void 0!==(null==n?void 0:n.y)&&Math.abs(n.y)<=90&&Math.abs(n.x)<=180)t=n.y,o=n.x;else{const n=oe(e);t=n.lat,o=n.lon}}catch(n){const i=oe(e);t=i.lat,o=i.lon}if(Math.abs(t)>90||Math.abs(o)>180)return void alert("Invalid coordinates - cannot open Street View");const n=`https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=${t},${o}`;window.open(n,"_blank")}catch(e){alert(`Error opening Street View: ${e.message}`)}}))),[Z.contextMenu,ee,oe]),ge=e.React.useCallback((()=>o(void 0,void 0,void 0,(function*(){var e;const{mapPoint:t}=Z.contextMenu;if(V.current&&t&&(null===(e=i.config)||void 0===e?void 0:e.pictometryUrl))try{let e,o;try{const n=yield ee(t);if(void 0!==(null==n?void 0:n.x)&&void 0!==(null==n?void 0:n.y)&&Math.abs(n.y)<=90&&Math.abs(n.x)<=180)e=n.y,o=n.x;else{const n=oe(t);e=n.lat,o=n.lon}}catch(n){const i=oe(t);e=i.lat,o=i.lon}if(Math.abs(e)>90||Math.abs(o)>180)return void alert("Invalid coordinates - cannot open Pictometry");const n=`${i.config.pictometryUrl}?x=${o.toFixed(8)}&y=${e.toFixed(8)}`;window.open(n,"_blank")}catch(e){alert(`Error opening Pictometry: ${e.message}`)}}))),[Z.contextMenu,ee,oe,null===(u=i.config)||void 0===u?void 0:u.pictometryUrl]),ye=e.React.useCallback((()=>o(void 0,void 0,void 0,(function*(){var e;const t=V.current;if(t)try{Z.measurementWidget&&Z.measurementWidget.destroy();const a=t.graphics.filter((e=>{var t,o,n;return"segment-label"===(null===(t=e.attributes)||void 0===t?void 0:t.type)||"total-label"===(null===(o=e.attributes)||void 0===o?void 0:o.type)||"measurement-graphic"===(null===(n=e.attributes)||void 0===n?void 0:n.type)}));t.graphics.removeMany(a.toArray());const r=["feet","yards","miles","meters","kilometers"],l=(null===(e=i.config)||void 0===e?void 0:e.measurementSettings)||{defaultUnits:"feet",unitDisplay:"single"};window.require(["esri/widgets/DistanceMeasurement2D","esri/Graphic","esri/symbols/TextSymbol","esri/geometry/geometryEngine","esri/geometry/Point"],((e,i,a,s,c)=>{try{const d=new e({view:t});let u="feet",m=null;if(r.includes(l.defaultUnits)&&(u=l.defaultUnits),"both"===l.unitDisplay)switch(u){case"feet":case"yards":m="meters";break;case"meters":m="feet";break;case"miles":m="kilometers";break;case"kilometers":m="miles"}const p=()=>{try{d.unit=u,d.viewModel&&(d.viewModel.unit=u)}catch(e){console.warn("Error setting initial distance unit:",e)}};t.ui.add(d,"top-right"),p(),d.when((()=>{n(d,"distance"),setTimeout((()=>p()),100),setTimeout((()=>p()),300),setTimeout((()=>p()),500)})),setTimeout((()=>{d.viewModel.start(),p()}),200);const f=(e,t)=>{var o;let n=`${e.toFixed(2)} ${t}`;if(m&&"both"===l.unitDisplay){n+=` (${(e*(null!==(o={"feet->meters":.3048,"meters->feet":3.28084,"miles->kilometers":1.60934,"kilometers->miles":.621371,"yards->meters":.9144,"meters->yards":1.09361}[`${t}->${m}`])&&void 0!==o?o:1)).toFixed(2)} ${m})`}return n},g=(e,o,n)=>{const r=new i({geometry:e,symbol:new a({text:o,color:[255,255,255],haloColor:[0,0,0],haloSize:2,font:{size:12,family:"Arial",weight:"bold"},verticalAlignment:"middle",horizontalAlignment:"center"}),attributes:{type:n}});t.graphics.add(r)},y=(e,n)=>o(void 0,void 0,void 0,(function*(){var i;const a=null===(i=e.paths)||void 0===i?void 0:i[0];if(!a)return;const r=a.map((([e,o])=>new c({x:e,y:o,spatialReference:t.spatialReference})));let l=0;const s=(e,t,n)=>o(void 0,void 0,void 0,(function*(){return new Promise((i=>{window.require(["esri/geometry/geometryEngine","esri/geometry/projection","esri/geometry/SpatialReference","esri/geometry/Polyline"],((a,r,l,s)=>o(void 0,void 0,void 0,(function*(){try{try{const o=new s({paths:[[[e.x,e.y],[t.x,t.y]]],spatialReference:e.spatialReference}),r=a.geodesicLength(o,n);if(r>0)return void i(r)}catch(e){console.log("Geodesic method failed, trying projection method")}try{yield r.load();const o=new l({wkid:4326}),s=r.project(e,o),c=r.project(t,o);if(s&&c){const e=a.distance(s,c,n);return void i(e)}}catch(e){console.log("Projection method failed, using planar calculation")}const o=a.distance(e,t,n);i(o)}catch(o){console.warn("All distance calculation methods failed, using basic calculation");const a=t.x-e.x,r=t.y-e.y;let l=Math.sqrt(a*a+r*r);const s=e.spatialReference;if(s&&s.unit){const e=s.unit.toLowerCase();e.includes("meter")&&"feet"===n?l*=3.28084:e.includes("feet")&&"meters"===n&&(l*=.3048)}i(l)}}))))}))}));for(let e=0;e<r.length-1;e++){const o=yield s(r[e],r[e+1],n);l+=o;const i=new c({x:(r[e].x+r[e+1].x)/2,y:(r[e].y+r[e+1].y)/2,spatialReference:t.spatialReference});g(i,f(o,n),"segment-label")}if(r.length>1){const e=new c({x:r.at(-1).x,y:r.at(-1).y+.01*t.extent.height,spatialReference:t.spatialReference});g(e,`Total: ${f(l,n)}`,"total-label")}})),v=()=>{const e=t.graphics.filter((e=>{var t;return["segment-label","total-label"].includes(null===(t=e.attributes)||void 0===t?void 0:t.type)}));t.graphics.removeMany(e.toArray())},x=[];x.push(d.viewModel.watch("measurement",(e=>{(null==e?void 0:e.geometry)&&(v(),y(e.geometry,d.unit).catch((o=>{var n;console.warn("Error drawing measurement labels:",o);try{const o=null===(n=e.geometry.paths)||void 0===n?void 0:n[0];if(!o)return;const i=o.map((([e,o])=>new c({x:e,y:o,spatialReference:t.spatialReference})));let a=0;for(let e=0;e<i.length-1;e++){const o=s.distance(i[e],i[e+1],d.unit);a+=o;const n=new c({x:(i[e].x+i[e+1].x)/2,y:(i[e].y+i[e+1].y)/2,spatialReference:t.spatialReference});g(n,f(o,d.unit),"segment-label")}if(i.length>1){const e=new c({x:i.at(-1).x,y:i.at(-1).y+.01*t.extent.height,spatialReference:t.spatialReference});g(e,`Total: ${f(a,d.unit)}`,"total-label")}}catch(e){console.error("Fallback distance calculation also failed:",e)}})))}))),x.push(d.watch("unit",(e=>{if(!r.includes(e))return console.warn(`Invalid unit received: ${e}. Reverting to primary unit: ${u}`),void setTimeout((()=>{d.unit=u}),50);const o=d.viewModel.measurement;(null==o?void 0:o.geometry)&&(v(),y(o.geometry,e).catch((n=>{var i;console.warn("Error drawing measurement labels on unit change:",n);try{const n=null===(i=o.geometry.paths)||void 0===i?void 0:i[0];if(!n)return;const a=n.map((([e,o])=>new c({x:e,y:o,spatialReference:t.spatialReference})));let r=0;for(let o=0;o<a.length-1;o++){const n=s.distance(a[o],a[o+1],e);r+=n;const i=new c({x:(a[o].x+a[o+1].x)/2,y:(a[o].y+a[o+1].y)/2,spatialReference:t.spatialReference});g(i,f(n,e),"segment-label")}if(a.length>1){const o=new c({x:a.at(-1).x,y:a.at(-1).y+.01*t.extent.height,spatialReference:t.spatialReference});g(o,`Total: ${f(r,e)}`,"total-label")}}catch(e){console.error("Fallback distance calculation also failed:",e)}})))}))),x.push(d.viewModel.watch("state",(e=>{"ready"===e&&v()})));const h=()=>{v(),x.forEach((e=>e.remove())),t.ui.remove(d),d.destroy(),J((e=>Object.assign(Object.assign({},e),{isMeasuring:!1,measurementWidget:null})))},b=e=>{"Escape"===e.key&&(h(),document.removeEventListener("keydown",b))};document.addEventListener("keydown",b),d.when((()=>{const e=d.container;e&&setTimeout((()=>{const t=document.createElement("div");t.style.cssText="display:flex;justify-content:center;gap:8px;margin-top:12px;padding:0 12px 12px;";const o=document.createElement("button");o.textContent="Close",o.style.cssText="background:#6c757d;color:white;border:none;padding:10px 20px;border-radius:4px;cursor:pointer;font-size:13px;font-weight:500;",o.onmouseenter=()=>o.style.background="#545b62",o.onmouseleave=()=>o.style.background="#6c757d",o.onclick=e=>{e.preventDefault(),e.stopPropagation(),h(),document.removeEventListener("keydown",b)},t.appendChild(o),e.appendChild(t),e.style.cssText+="background:rgba(255,255,255,0.95);backdrop-filter:blur(10px);border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.15);border:1px solid rgba(0,0,0,0.1);min-width:260px;"}),300)})),J((e=>Object.assign(Object.assign({},e),{isMeasuring:!0,measurementWidget:d})))}catch(e){console.error(`Error starting measurement: ${e.message}`)}}))}catch(e){console.error(`Error loading measurement tools: ${e.message}`)}}))),[Z.measurementWidget,null===(m=i.config)||void 0===m?void 0:m.measurementSettings]),ve=e.React.useCallback((()=>o(void 0,void 0,void 0,(function*(){var e;const t=V.current;if(t)try{Z.areaMeasurementWidget&&Z.areaMeasurementWidget.destroy();const o=t.graphics.filter((e=>{var t,o,n;return"segment-label"===(null===(t=e.attributes)||void 0===t?void 0:t.type)||"total-label"===(null===(o=e.attributes)||void 0===o?void 0:o.type)||"measurement-graphic"===(null===(n=e.attributes)||void 0===n?void 0:n.type)}));t.graphics.removeMany(o.toArray());const a=(null===(e=i.config)||void 0===e?void 0:e.measurementSettings)||{defaultUnits:"feet",unitDisplay:"single"};window.require(["esri/widgets/AreaMeasurement2D","esri/Graphic","esri/symbols/TextSymbol","esri/geometry/geometryEngine","esri/geometry/Point"],((e,o,i,r,l)=>{try{const o=new e({view:t});let i,r=null;switch(a.defaultUnits){case"feet":default:i="square-feet";break;case"meters":i="square-meters";break;case"miles":i="square-miles";break;case"kilometers":i="square-kilometers";break;case"yards":i="square-yards"}if("both"===a.unitDisplay)switch(a.defaultUnits){case"feet":case"yards":r="square-meters";break;case"meters":r="square-feet";break;case"miles":r="square-kilometers";break;case"kilometers":r="square-miles"}const l=()=>{try{o.unit=i,o.viewModel&&(o.viewModel.unit=i)}catch(e){console.warn("Error setting initial unit:",e)}};t.ui.add(o,"top-right"),l(),o.when((()=>{n(o,"area"),setTimeout((()=>l()),100),setTimeout((()=>l()),300),setTimeout((()=>l()),500);const e=o.container;e&&setTimeout((()=>{const t=document.createElement("div");t.style.cssText="display:flex;justify-content:center;gap:8px;margin-top:12px;padding:0 12px 12px;";const o=document.createElement("button");o.textContent="Close",o.style.cssText="background:#6c757d;color:white;border:none;padding:10px 20px;border-radius:4px;cursor:pointer;font-size:13px;font-weight:500;",o.onmouseenter=()=>o.style.background="#545b62",o.onmouseleave=()=>o.style.background="#6c757d",o.onclick=e=>{e.preventDefault(),e.stopPropagation(),s(),document.removeEventListener("keydown",c)},t.appendChild(o),e.appendChild(t),e.style.cssText+="background:rgba(255,255,255,0.95);backdrop-filter:blur(10px);border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.15);border:1px solid rgba(0,0,0,0.1);min-width:260px;"}),300)})),setTimeout((()=>{o.viewModel.start(),l()}),200),o.watch("unit",(e=>{["square-feet","square-yards","square-miles","square-meters","square-kilometers","acres"].includes(e)||(console.warn(`Invalid area unit received: ${e}. Reverting to primary unit: ${i}`),setTimeout((()=>{o.unit=i}),50))})),J((e=>Object.assign(Object.assign({},e),{isMeasuringArea:!0,areaMeasurementWidget:o})));const s=()=>{o&&(t.ui.remove(o),o.destroy()),J((e=>Object.assign(Object.assign({},e),{isMeasuringArea:!1,areaMeasurementWidget:null})))},c=e=>{"Escape"===e.key&&(s(),document.removeEventListener("keydown",c))};document.addEventListener("keydown",c)}catch(e){console.error(`Error starting area measurement: ${e.message}`)}}))}catch(e){console.error(`Error loading area measurement tools: ${e.message}`)}}))),[Z.areaMeasurementWidget,null===(p=i.config)||void 0===p?void 0:p.measurementSettings]),xe=e.React.useCallback(((e,t)=>o(void 0,void 0,void 0,(function*(){var o,n,a,r,l;try{const s=(null===(o=i.config)||void 0===o?void 0:o.whatsHereSettings)||{};let c=t;if((null===(n=i.config)||void 0===n?void 0:n.reverseGeocodeWkid)&&i.config.reverseGeocodeWkid!==(null===(a=t.spatialReference)||void 0===a?void 0:a.wkid))try{c=yield te(t,i.config.reverseGeocodeWkid)}catch(e){console.warn("Projection failed, using original coordinates:",e),c=t}const d=`${e.url}/query`,u={x:c.x,y:c.y,spatialReference:{wkid:(null===(r=c.spatialReference)||void 0===r?void 0:r.wkid)||4326}},m=s.spatialRelationship||"esriSpatialRelIntersects",p=[m.startsWith("esriSpatialRel")?m:`esriSpatialRel${m.charAt(0).toUpperCase()}${m.slice(1)}`,"esriSpatialRelIntersects","esriSpatialRelContains","esriSpatialRelWithin"],f=[];f.push({geometry:JSON.stringify(u),geometryType:"esriGeometryPoint",spatialRel:p[0],outFields:e.fields&&e.fields.length>0?e.fields.join(","):"*",returnGeometry:s.includeGeometry?"true":"false",resultRecordCount:(s.maxResults||10).toString(),f:"json"}),s.searchRadius&&s.searchRadius>0&&f.push({geometry:JSON.stringify(u),geometryType:"esriGeometryPoint",spatialRel:p[0],outFields:e.fields&&e.fields.length>0?e.fields.join(","):"*",returnGeometry:s.includeGeometry?"true":"false",resultRecordCount:(s.maxResults||10).toString(),distance:s.searchRadius.toString(),units:"esriSRUnit_Meter",f:"json"}),f.push({geometry:`${c.x},${c.y}`,geometryType:"esriGeometryPoint",spatialRel:"esriSpatialRelIntersects",outFields:"*",returnGeometry:"false",f:"json"});const g=1,y={xmin:c.x-g,ymin:c.y-g,xmax:c.x+g,ymax:c.y+g,spatialReference:{wkid:(null===(l=c.spatialReference)||void 0===l?void 0:l.wkid)||4326}};f.push({geometry:JSON.stringify(y),geometryType:"esriGeometryEnvelope",spatialRel:"esriSpatialRelIntersects",outFields:e.fields&&e.fields.length>0?e.fields.join(","):"*",returnGeometry:"false",f:"json"});let v=null;for(let t=0;t<f.length;t++){const o=f[t],n=new URLSearchParams(o);s.orderBy&&n.append("orderByFields",s.orderBy);try{const t=yield fetch(`${d}?${n.toString()}`,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"}});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const o=yield t.json();if(o.error){v=new Error(`[${o.error.code||"Unknown"}] ${o.error.message||`Query failed for layer ${e.name}`}`);continue}return{layerName:e.name,features:o.features||[],layerUrl:e.url}}catch(e){v=e}}throw v||new Error(`All query attempts failed for layer ${e.name}`)}catch(t){return console.error(`Error querying layer ${e.name}:`,t),{layerName:e.name,features:[],layerUrl:e.url}}}))),[te,i.config]),he=e.React.useCallback((e=>{var t;const o=(null===(t=i.config)||void 0===t?void 0:t.uiSettings)||{},n=!1!==o.showLayerNames,a=!1!==o.groupByLayer,r=!1!==o.showFieldAliases;let l="";return e.forEach((({layerName:e,features:t,layerUrl:o},i)=>{0!==t.length&&(n&&a&&(l+=`\n                    <div style="\n                        font-weight: 600; \n                        color: #323232; \n                        margin: ${i>0?"20px":"0px"} 0 12px 0; \n                        padding-bottom: 6px;\n                        border-bottom: 2px solid #0079c1;\n                        font-size: 15px;\n                        text-transform: uppercase;\n                        letter-spacing: 0.5px;\n                    ">\n                        ${e}\n                    </div>\n                `),t.forEach(((i,s)=>{const c=i.attributes;!a&&n&&(l+=`\n                        <div style="\n                            display: flex;\n                            align-items: flex-start;\n                            margin-bottom: 8px;\n                            padding: 6px 0;\n                            border-bottom: 1px solid #e0e0e0;\n                        ">\n                            <div style="\n                                font-weight: 600;\n                                color: #0079c1;\n                                white-space: nowrap;\n                                flex-shrink: 0;\n                                min-width: 60px;\n                                font-size: 13px;\n                            ">\n                                Layer:\n                            </div>\n                            <div style="\n                                color: #323232;\n                                word-wrap: break-word;\n                                flex: 1;\n                                margin-left: 8px;\n                                font-size: 13px;\n                            ">\n                                ${e}\n                            </div>\n                        </div>\n                    `);Object.entries(c).filter((([e,t])=>!["OBJECTID","FID","SHAPE","Shape","GlobalID","GLOBALID"].includes(e)&&(null!=t&&""!==t))).forEach((([e,t])=>{const n=be(e,o,r),i=we(t,e);l+=`\n                        <div style="\n                            display: flex;\n                            align-items: flex-start;\n                            margin-bottom: 6px;\n                            padding: 2px 0;\n                            min-height: 20px;\n                        ">\n                            <div style="\n                                font-weight: 600;\n                                color: #0079c1;\n                                white-space: nowrap;\n                                flex-shrink: 0;\n                                min-width: 120px;\n                                font-size: 13px;\n                                line-height: 1.4;\n                            ">\n                                ${n}:\n                            </div>\n                            <div style="\n                                color: #323232;\n                                word-wrap: break-word;\n                                flex: 1;\n                                margin-left: 8px;\n                                font-size: 13px;\n                                line-height: 1.4;\n                            ">\n                                ${i}\n                            </div>\n                        </div>\n                    `})),s<t.length-1&&(l+='<div style="margin: 16px 0; border-bottom: 1px solid #e8e8e8;"></div>')})))})),l||'<div style="color: #6e6e6e; font-style: italic; text-align: center; padding: 20px;">No features found at this location.</div>'}),[null===(f=i.config)||void 0===f?void 0:f.uiSettings,Z.layerFieldMetadata]),be=e.React.useCallback(((e,t,o)=>{var n,a,r,l;if(!o)return e;const s=null===(n=Z.layerFieldMetadata[t])||void 0===n?void 0:n[e];if((null==s?void 0:s.alias)&&s.alias!==e)return s.alias;const c=null===(r=null===(a=i.config)||void 0===a?void 0:a.featureLayers)||void 0===r?void 0:r.find((e=>e.url===t));if(null===(l=null==c?void 0:c.aliasFields)||void 0===l?void 0:l[e])return c.aliasFields[e];const d={OBJECTID:"Object ID",ObjectID:"Object ID",FID:"Feature ID",SHAPE:"Geometry",Shape:"Geometry",SHAPE_Area:"Area",SHAPE_Length:"Length",Shape_Area:"Area",Shape_Length:"Length",CREATED_DATE:"Created Date",LAST_EDITED_DATE:"Last Modified",CreationDate:"Created Date",EditDate:"Last Modified",GlobalID:"Global ID",GLOBALID:"Global ID",NAME:"Name",Name:"Name",TYPE:"Type",Type:"Type",STATUS:"Status",Status:"Status",DESCRIPTION:"Description",Description:"Description",ADDRESS:"Address",Address:"Address",CITY:"City",City:"City",STATE:"State",State:"State",ZIP:"ZIP Code",ZIPCODE:"ZIP Code",ZIP_CODE:"ZIP Code",PHONE:"Phone",Phone:"Phone",EMAIL:"Email",Email:"Email",URL:"Website",WEBSITE:"Website",Website:"Website",TRACTCE20:"Census Tract",NAMELSAD20:"Census Tract Name",TOTALPOP:"Total Population",GEOID20:"Geographic ID"};if(d[e])return d[e];const u=e.toLowerCase(),m=Object.keys(d).find((e=>e.toLowerCase()===u));return m?d[m]:e.replace(/_/g," ").replace(/([A-Z])/g," $1").replace(/\s+/g," ").trim().replace(/\b\w/g,(e=>e.toUpperCase()))}),[null===(g=i.config)||void 0===g?void 0:g.featureLayers,Z.layerFieldMetadata]),we=e.React.useCallback(((e,t)=>{if(null==e)return"";if(t.toLowerCase().includes("date")||t.toLowerCase().includes("time"))try{const t=new Date(e);if(!isNaN(t.getTime()))return t.toLocaleDateString()+" "+t.toLocaleTimeString()}catch(e){}return"number"==typeof e?t.toLowerCase().includes("area")?e.toLocaleString()+" sq units":t.toLowerCase().includes("length")||t.toLowerCase().includes("distance")?e.toLocaleString()+" units":e%1!=0?e.toFixed(2):e.toLocaleString():String(e)}),[]),ke=e.React.useCallback((e=>{var t,n;const{mapPoint:a}=Z.contextMenu,r=V.current;if(r&&a){switch(e){case"zoom-in":r.goTo({target:a,zoom:r.zoom+1}).catch((()=>{}));break;case"zoom-out":r.goTo({target:a,zoom:r.zoom-1}).catch((()=>{}));break;case"center-here":r.goTo({target:a}).catch((()=>{}));break;case"get-coordinates":ne();break;case"plot-coordinates":ce();break;case"plot-marker":de();break;case"add-text":ae();break;case"clear-coordinates":ue();break;case"clear-markers":me();break;case"clear-text":se();break;case"clear-all-graphics":pe();break;case"street-view":fe();break;case"pictometry":ge();break;case"measure-distance":ye();break;case"measure-area":ve();break;case"whats-here":{const e=()=>o(void 0,void 0,void 0,(function*(){var e,t,n,l,s,c,d,u,m,p;try{let f=[],g="";if(null===(e=i.config)||void 0===e?void 0:e.reverseGeocodeUrl){const e=null!==(t=i.config.reverseGeocodeWkid)&&void 0!==t?t:4326;let o;try{o=yield te(a,e);const t=yield new Promise((e=>{window.require(["esri/rest/locator"],(t=>{e(t)}))})),r={location:o,distance:1e3,outSR:o.spatialReference,returnIntersection:!1,locationType:"rooftop"},d=yield t.locationToAddress(i.config.reverseGeocodeUrl,r);g=(null==d?void 0:d.address)||(null===(n=null==d?void 0:d.attributes)||void 0===n?void 0:n.Match_addr)||(null===(l=null==d?void 0:d.attributes)||void 0===l?void 0:l.Address)||(null===(s=null==d?void 0:d.attributes)||void 0===s?void 0:s.StAddr)||(null===(c=null==d?void 0:d.attributes)||void 0===c?void 0:c.Street)||"","string"!=typeof g&&(g="")}catch(t){console.warn("Geocoding failed:",t);try{o||(o=yield te(a,e)),g=4326===e?`${o.y.toFixed(6)}, ${o.x.toFixed(6)}`:`${o.x.toFixed(2)}, ${o.y.toFixed(2)}`}catch(e){console.warn("Projection also failed:",e),g=`${a.x.toFixed(2)}, ${a.y.toFixed(2)}`}}}if(null===(u=null===(d=i.config)||void 0===d?void 0:d.featureLayers)||void 0===u?void 0:u.length){const e=i.config.featureLayers.map((e=>o(void 0,void 0,void 0,(function*(){try{return yield xe(e,a)}catch(t){return{layerName:e.name,features:[],layerUrl:e.url}}}))));f=(yield Promise.allSettled(e)).filter((e=>"fulfilled"===e.status&&e.value.features.length>0)).map((e=>e.value))}let y="";y+="<div style=\"font-family: 'Avenir Next', 'Helvetica Neue', Helvetica, Arial, sans-serif; color: #323232; line-height: 1.4; font-size: 13px; padding: 4px 0;\">",g&&(y+=`\n                                <div style="\n                                    display: flex;\n                                    align-items: flex-start;\n                                    margin-bottom: 12px;\n                                    padding: 8px 0;\n                                    border-bottom: 2px solid #0079c1;\n                                ">\n                                    <div style="\n                                        font-weight: 600;\n                                        color: #0079c1;\n                                        white-space: nowrap;\n                                        flex-shrink: 0;\n                                        min-width: 120px;\n                                        font-size: 13px;\n                                    ">\n                                        Location:\n                                    </div>\n                                    <div style="\n                                        color: #323232;\n                                        word-wrap: break-word;\n                                        flex: 1;\n                                        margin-left: 8px;\n                                        font-size: 13px;\n                                        font-weight: 500;\n                                    ">\n                                        ${g}\n                                    </div>\n                                </div>\n                            `),f.length>0&&(y+=he(f)),g||0!==f.length||(y+='\n                                <div style="color: #6e6e6e; font-style: italic; text-align: center; padding: 20px; background-color: #f8f9fa; border-radius: 4px; margin: 10px 0;">\n                                    No information found at this location.\n                                </div>\n                            '),y+="</div>",r.openPopup({title:"\u{1f4cd} What's here?",content:`\n                                <style>\n                                    .esri-popup__main-container {\n                                        min-width: 450px !important;\n                                        max-width: 550px !important;\n                                    }\n                                    .esri-popup__content {\n                                        min-width: 430px !important;\n                                    }\n                                    .esri-popup__header-title {\n                                        font-size: 16px !important;\n                                        font-weight: 600 !important;\n                                    }\n                                </style>\n                                <div style="max-height: ${(null===(p=null===(m=i.config)||void 0===m?void 0:m.uiSettings)||void 0===p?void 0:p.popupMaxHeight)||400}px; overflow-y: auto; min-width: 430px; padding: 4px;">\n                                    ${y}\n                                </div>\n                            `,location:a})}catch(e){console.error("Error in What's Here functionality:",e),r.openPopup({title:"\u{1f4cd} What's here?",content:'\n                                <div style="color: #d32f2f; padding: 16px; text-align: center;">\n                                    <strong>Error occurred while querying location information.</strong><br/>\n                                    <small style="color: #666;">Please check the console for more details.</small>\n                                </div>\n                            ',location:a})}}));if(!((null===(t=i.config)||void 0===t?void 0:t.reverseGeocodeUrl)||(null===(n=i.config)||void 0===n?void 0:n.featureLayers)&&0!==i.config.featureLayers.length)){alert("What's Here functionality requires either a geocoding service URL or feature layers to be configured. Please check widget settings.");break}e();break}}K()}else K()}),[Z.contextMenu,K,ne,ce,de,ae,ue,me,se,pe,fe,ge,ye,ve,te,xe,he,i.config,be]),Me=e.React.useCallback((e=>{if(null==e?void 0:e.view){const t=e.view;V.current=t,t.when((()=>{const e=t.container;t.on("pointer-down",(n=>o(void 0,void 0,void 0,(function*(){var a,r,l,s;2===n.button&&(n.native&&(null===(r=(a=n.native).preventDefault)||void 0===r||r.call(a),null===(s=(l=n.native).stopImmediatePropagation)||void 0===s||s.call(l)),n.stopPropagation(),setTimeout((()=>o(void 0,void 0,void 0,(function*(){var o;const a=t.toMap({x:n.x,y:n.y});let r;const l=(null===(o=i.config)||void 0===o?void 0:o.coordinateSystem)||"map";if("map"===l)r=`${a.x.toFixed(2)}, ${a.y.toFixed(2)}`;else if("webMercator"===l)try{const e=yield ee(a);if(void 0!==(null==e?void 0:e.x)&&void 0!==(null==e?void 0:e.y)&&Math.abs(e.y)<=90&&Math.abs(e.x)<=180)r=`${e.y.toFixed(6)}, ${e.x.toFixed(6)}`;else{const e=oe(a);r=`${e.lat.toFixed(6)}, ${e.lon.toFixed(6)}`}}catch(e){const t=oe(a);r=`${t.lat.toFixed(6)}, ${t.lon.toFixed(6)}`}else r=`${a.x.toFixed(2)}, ${a.y.toFixed(2)}`;const s=e.getBoundingClientRect();let c=n.x+s.left,d=n.y+s.top;const u=window.innerWidth,m=window.innerHeight;c+200>u&&(c-=200),d+420>m&&(d-=420),c=Math.max(10,c),d=Math.max(10,d),J((e=>Object.assign(Object.assign({},e),{showingContextMenu:!0,contextMenu:{visible:!0,x:c,y:d,mapPoint:a,coordinateLabel:r}}))),setTimeout((()=>{J((e=>Object.assign(Object.assign({},e),{showingContextMenu:!1})))}),100)}))),10))})))),t.on("click",(e=>{2===e.button||Z.showingContextMenu||K()})),t.on("drag",K)})).catch((()=>{}))}}),[ee,oe,K,null===(y=i.config)||void 0===y?void 0:y.coordinateSystem,Z.showingContextMenu]),Ce={position:"fixed",top:Z.contextMenu.y,left:Z.contextMenu.x,backgroundColor:"white",border:"1px solid #ccc",borderRadius:"4px",boxShadow:"0 2px 10px rgba(0,0,0,0.1)",zIndex:1e3,minWidth:"200px",display:Z.contextMenu.visible?"block":"none"},Re={padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid #eee",fontSize:"14px"},$e=e.React.memo((({action:t,icon:o,text:n,enabled:i=!0})=>i?e.React.createElement("div",{style:Re,onClick:()=>ke(t),onMouseEnter:e=>e.currentTarget.style.backgroundColor="#f5f5f5",onMouseLeave:e=>e.currentTarget.style.backgroundColor="transparent"},o," ",n):null));return e.React.createElement("div",{className:"widget-right-click-map",style:{width:"100%",height:"100%",position:"relative"}},(null==X?void 0:X.length)>0?e.React.createElement(t.JimuMapViewComponent,{useMapWidgetId:X[0],onActiveViewChange:Me}):e.React.createElement("div",{style:{padding:"20px",textAlign:"center"}},e.React.createElement("p",null,"Please configure this widget to use a Map widget."),e.React.createElement("p",null,"Go to widget settings and select a map to connect to.")),e.React.createElement("div",{id:"context-menu",style:Ce},e.React.createElement($e,{action:"zoom-in",icon:"\u{1f50d}",text:"Zoom In",enabled:!1!==(null===(x=null===(v=i.config)||void 0===v?void 0:v.enabledActions)||void 0===x?void 0:x.zoomIn)}),e.React.createElement($e,{action:"zoom-out",icon:"\u{1f50d}",text:"Zoom Out",enabled:!1!==(null===(b=null===(h=i.config)||void 0===h?void 0:h.enabledActions)||void 0===b?void 0:b.zoomOut)}),e.React.createElement($e,{action:"center-here",icon:"\u{1f4cd}",text:"Center Here",enabled:!1!==(null===(k=null===(w=i.config)||void 0===w?void 0:w.enabledActions)||void 0===k?void 0:k.centerHere)}),e.React.createElement($e,{action:"plot-marker",icon:"\u{1f534}",text:"Plot Marker",enabled:!1!==(null===(C=null===(M=i.config)||void 0===M?void 0:M.enabledActions)||void 0===C?void 0:C.plotMarker)}),!1!==(null===($=null===(R=i.config)||void 0===R?void 0:R.enabledActions)||void 0===$?void 0:$.copyCoordinates)&&Z.contextMenu.coordinateLabel&&e.React.createElement($e,{action:"get-coordinates",icon:"\u{1f4cb}",text:`Copy Coordinates: ${Z.contextMenu.coordinateLabel}`}),e.React.createElement($e,{action:"plot-coordinates",icon:"\u{1f4cc}",text:"Plot Coordinate",enabled:!1!==(null===(E=null===(S=i.config)||void 0===S?void 0:S.enabledActions)||void 0===E?void 0:E.plotCoordinates)}),e.React.createElement($e,{action:"add-text",icon:"\u{1f170}\ufe0f",text:"Add Text",enabled:!1!==(null===(O=null===(T=i.config)||void 0===T?void 0:T.enabledActions)||void 0===O?void 0:O.addText)}),(Z.coordinateMarkers.length>0||Z.simpleMarkers.length>0||Z.textGraphics.length>0)&&e.React.createElement($e,{action:"clear-all-graphics",icon:"\u{1f9f9}",text:`Clear All Graphics (${Z.coordinateMarkers.length+Z.simpleMarkers.length+Z.textGraphics.length})`,enabled:!1!==(null===(A=null===(P=i.config)||void 0===P?void 0:P.enabledActions)||void 0===A?void 0:A.plotCoordinates)||!1!==(null===(F=null===(j=i.config)||void 0===j?void 0:j.enabledActions)||void 0===F?void 0:F.plotMarker)||!1!==(null===(D=null===(L=i.config)||void 0===L?void 0:L.enabledActions)||void 0===D?void 0:D.addText)}),e.React.createElement($e,{action:"street-view",icon:"\u{1f5fa}\ufe0f",text:"Open in Google Street View",enabled:!1!==(null===(W=null===(z=i.config)||void 0===z?void 0:z.enabledActions)||void 0===W?void 0:W.streetView)}),e.React.createElement($e,{action:"pictometry",icon:"\u{1f4f7}",text:"Open in Pictometry",enabled:!1!==(null===(q=null===(I=i.config)||void 0===I?void 0:I.enabledActions)||void 0===q?void 0:q.pictometry)&&!!(null===(G=i.config)||void 0===G?void 0:G.pictometryUrl)}),e.React.createElement($e,{action:"measure-distance",icon:"\u{1f4cf}",text:"Measure Distance",enabled:!1!==(null===(N=null===(_=i.config)||void 0===_?void 0:_.enabledActions)||void 0===N?void 0:N.measureDistance)}),e.React.createElement($e,{action:"measure-area",icon:"\u{1f4d0}",text:"Measure Area",enabled:!1!==(null===(H=null===(U=i.config)||void 0===U?void 0:U.enabledActions)||void 0===H?void 0:H.measureArea)}),!1!==(null===(Y=null===(B=i.config)||void 0===B?void 0:B.enabledActions)||void 0===Y?void 0:Y.whatsHere)&&e.React.createElement("div",{style:Object.assign(Object.assign({},Re),{borderBottom:"none"}),onClick:()=>ke("whats-here"),onMouseEnter:e=>e.currentTarget.style.backgroundColor="#f5f5f5",onMouseLeave:e=>e.currentTarget.style.backgroundColor="transparent"},"\u2753 What's here?")),Z.showTextDialog&&e.React.createElement("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:2e3,display:"flex",alignItems:"center",justifyContent:"center"}},e.React.createElement("div",{style:{backgroundColor:"white",borderRadius:"8px",padding:"24px",minWidth:"400px",maxWidth:"500px",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)"}},e.React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px",paddingBottom:"12px",borderBottom:"1px solid #e0e0e0"}},e.React.createElement("h3",{style:{margin:0,fontSize:"18px",fontWeight:"600"}},"\u{1f170}\ufe0f Enter Your Text"),e.React.createElement("button",{onClick:le,style:{background:"none",border:"none",fontSize:"24px",cursor:"pointer",color:"#666",padding:"0",width:"30px",height:"30px",display:"flex",alignItems:"center",justifyContent:"center"}},"\u2715")),e.React.createElement("p",{style:{margin:"0 0 16px 0",color:"#666",fontSize:"14px",lineHeight:"1.4"}},"Type the text you want to add at this location on the map."),e.React.createElement("input",{type:"text",placeholder:"Example Text",style:{width:"100%",padding:"12px",border:"2px solid #e0e0e0",borderRadius:"4px",fontSize:"14px",marginBottom:"20px",boxSizing:"border-box"},autoFocus:!0,onKeyDown:e=>{if("Enter"===e.key){const t=e.target;t.value.trim()&&re(t.value)}else"Escape"===e.key&&le()}}),e.React.createElement("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px"}},e.React.createElement("button",{onClick:le,style:{padding:"10px 20px",border:"2px solid #ccc",borderRadius:"4px",backgroundColor:"white",color:"#666",cursor:"pointer",fontSize:"14px",fontWeight:"500"}},"Cancel"),e.React.createElement("button",{onClick:()=>{const e=document.querySelector('input[placeholder="Example Text"]');e&&e.value.trim()&&re(e.value)},style:{padding:"10px 20px",border:"2px solid #007ACC",borderRadius:"4px",backgroundColor:"#007ACC",color:"white",cursor:"pointer",fontSize:"14px",fontWeight:"500"}},"OK")))))};function l(e){i.p=e}})(),a})())}}}));